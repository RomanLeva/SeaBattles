package seabattles.service;import seabattles.aspect.exception.UserDuplicateException;import seabattles.aspect.exception.UserLoginException;import seabattles.entity.User;import lombok.RequiredArgsConstructor;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import seabattles.repository.UserJpaRepo;import seabattles.service.dto.UserAuthDto;import seabattles.service.dto.UserDto;import seabattles.service.mapper.MapperServiceToRepoUserDto;import java.util.List;@Service@RequiredArgsConstructorpublic class UserService {    @Autowired    private final UserJpaRepo userRepository;    @Autowired    private final MapperServiceToRepoUserDto mapper;    public List<UserDto> getAllUsers() {        List<User> userList = userRepository.findAll();        return mapper.mapUserToDtoList(userList);    }    public UserDto registerUser(User user) {        User maybeOldUser = userRepository.findByLogin(user.getLogin());        if (maybeOldUser != null){            throw new UserDuplicateException("User with this login is already registered.");        } else {            return mapper.mapUserToDto(userRepository.save(user));        }    }    public UserDto loginUser(UserAuthDto userAuthDto) {        User user = mapper.mapUserAuthDtoToUser(userAuthDto);        User loggedUser = userRepository.findByLoginAndPassword(user.getLogin(), user.getPassword());        if (loggedUser == null){            throw new UserLoginException("User with this login and password is not registered yet.");        } else {            return mapper.mapUserToDto(loggedUser);        }    }    public UserDto updateUserPass(UserAuthDto userAuthDto, String newPassword){        User user = mapper.mapUserAuthDtoToUser(userAuthDto);        User loggedUser = userRepository.findByLoginAndPassword(user.getLogin(), user.getPassword());        if (loggedUser == null){            throw new UserLoginException("User with this login and password is not registered yet.");        } else {            loggedUser.setPassword(newPassword);            userRepository.flush();            return mapper.mapUserToDto(loggedUser);        }    }}